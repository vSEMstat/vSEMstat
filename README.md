# О проекте

Быстрая библиотека для работы в качестве API клиента для Топвизор и Яндекс.Метрика.

## Использование

1. Скачать библиотеку на ваш хостинг
2. Создать пустую базу данных Mysql
3. Заполнить конфигруацию в файле /oauth/config.php
4. Выполнить /ouath/index.php и получить токен доступа к Яндекс.Метрика
5. Заполнить конфигруацию в файле /examples/EasyExperiment/config.php
6. Выполнить файл /examples/EasyExperiment/index.php
7. Готовые данные уже собраны в вашей базе Mysql!

## Библиотека

### src

Код библиотеки расположен в каталоге src. Единая точка входа - файл vSEMstat.php - именно он подключается в примере. Файл vSEMstat.php подключает все компоненты библиотеки.

Компоненты библиотеки:

* BaseService.php - базовые методы сервисов
* MetrikaService.php - реализация методов для работы с API Яндекс.Метрика
* TopvisorService.php - реализация методов для работы с API Топвизор

## Инструменты и примеры

### oauth

Инструмент для получения токена доступа к Яндекс.Метрика.

Каталог содержит конфигурационный файл config.php
```
'metrika' => [
		'client_id' => '',	// Идентификатор приложения
		'client_secret' => '',	// Пароль приложения
	],
```
Каталог содержит пример получения Oauth токена для доступа к вашему приложению Яндекс.Метрика. Для его использования разместите код библиотеки на вашем хостинге, введите данные приложения яндекса в файле конфигурации config.php и откройте в браузере ссылку
```
https://ваш_адрес_хоста/oauth/index.php
```
После авторизации в яндексе произойдет переадресация на этот же адрес и на странице отобразится Oauth токен. Токен автоматически сохранится в файл /oauth/oauth_key.key. Этот токен потребуется при работе с API Яндекс.Метрика

### examples

#### EasyExperiment

Содержит файл config.php, в котором выполняются настройки:
 * Настройка коннекторов
```
'metrika' => [
		'client_id' => '',		// Идентификатор приложения
		'client_secret' => '',	// Пароль приложения
		'counter_id' => '',		// счетчик метрики
		'token' => ''			// токен доступа
	],

	'topvisor' => [
		'user_id' => '',		// идентификатор пользователя
		'api_key' => '',		// api ключ
		'project_id' => '',		// идентиикатор проекта
	],

	'mysql' => [
	    'host' => 'mysql',		// имя хоста сервера базы данных
	    'username' => 'root',	// пользователь базы данных
	    'password' => '',	// пароль
	    'database' => 'vSEMstat',// имя базы данных
	],
```
* Настройка периода импорта
```
'dates' = [
		'2020-12-07',						// дата начала импорта
		date('Y-m-d', strtotime('today')),  // дата завершения импорта
	],
```

* Списки URL из кабинета Топвизора
```
'topvisor_google_a' => [
		'https://topvisor.com/project/dynamics/2535875/#historyView=1&templateDateRange=data_range_1y&dates=&date1=20.12.2019&date2=20.12.2020&typeRange=2&typeRangeCompare=4&countDates=31&regionsIndexes=1&competitorsIds=&folderId=0&groupId=0&tags=&dynamic=&minPos=&maxPos=&onlyExistsFirstDate=0'
	],
	// список URL из личного кабинета Топвизора для списка 2
	'topvisor_google_b' = [

	],
	// список URL из личного кабинета Топвизора для списка 3
	'topvisor_yandex_a' = [

	],
	// список URL из личного кабинета Топвизора для списка 4
	'topvisor_yandex_b' = [

	],
```

* Фильтры для метрики
```
// фильтры A яндекс и google
	'metrika_yandex_a' => "ym:s:searchEngineRootName=@'Яндекс'",
	'metrika_google_a' => "ym:s:searchEngineRootName=@'Google'",

	// фильтры B яндекс и google
	'metrika_yandex_a' => "ym:s:searchEngineRootName=@'Яндекс'",
	'metrika_google_b' => "ym:s:searchEngineRootName=@'Google'",
```

Содержит файл index.php, который реализует простой пример использования библиотеки для выбора данных из Яндекс.Метрика и Топвизор и формирует представление в Mysql таблице.
